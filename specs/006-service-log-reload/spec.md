# Feature Specification: Service Log Viewer and Reload

**Feature Branch**: `006-service-log-reload`
**Created**: 2025-11-02
**Status**: Draft
**Input**: User description: "view service log and allow to reload service with selected config"

## User Scenarios & Testing _(mandatory)_

### User Story 1 - View Service Logs (Priority: P1)

Users need to monitor skhd service activity and troubleshoot configuration issues by viewing real-time and historical log output.

**Why this priority**: Log visibility is the foundation for understanding service behavior and is essential for troubleshooting. Without logs, users cannot diagnose why shortcuts aren't working.

**Independent Test**: Can be fully tested by starting the application, opening the log viewer, and verifying that skhd service logs are displayed. Delivers immediate value by providing visibility into service operations.

**Acceptance Scenarios**:

1. **Given** the application is open, **When** user navigates to the log viewer, **Then** current skhd service logs are displayed in chronological order
2. **Given** logs are displayed, **When** skhd service generates new log entries, **Then** new entries appear automatically without requiring manual refresh
3. **Given** extensive log history exists, **When** user scrolls through logs, **Then** previous log entries are accessible and navigable
4. **Given** logs contain error messages, **When** logs are displayed, **Then** errors are visually distinguished from informational messages

---

### User Story 2 - Reload Service with Active Configuration (Priority: P2)

Users need to apply configuration changes by reloading the skhd service with the currently active configuration file.

**Why this priority**: Reloading the service is necessary to apply changes, but requires log visibility (P1) to verify success.

**Independent Test**: Can be tested by modifying a configuration file, clicking the reload button, and verifying the service restarts successfully. Delivers value by eliminating manual terminal commands.

**Acceptance Scenarios**:

1. **Given** a configuration file is loaded in the application, **When** user clicks reload service, **Then** skhd service restarts with the active configuration
2. **Given** service reload is initiated, **When** reload process completes successfully, **Then** user receives confirmation that service restarted successfully
3. **Given** service reload is initiated, **When** reload fails due to configuration errors, **Then** user sees error message with details about what failed
4. **Given** service is currently running, **When** user initiates reload, **Then** service downtime is minimized (seamless restart)

---

### User Story 3 - Import Configuration Before Reload (Priority: P3)

Users need to import a different configuration file before reloading the service, enabling testing of different configurations without manual file management.

**Why this priority**: Configuration import enhances flexibility but depends on reload functionality (P2) to be useful.

**Independent Test**: Can be tested by clicking "Import Config", selecting a configuration file, and reloading the service with the imported configuration. Delivers value by supporting configuration switching workflows.

**Acceptance Scenarios**:

1. **Given** user is viewing the service control page, **When** user clicks "Import Config", **Then** a file picker dialog opens to select a configuration file
2. **Given** file picker is open, **When** user selects a valid skhd configuration file, **Then** the file is imported and becomes the active configuration
3. **Given** a configuration is imported, **When** user views the service control section, **Then** the currently active configuration path is displayed
4. **Given** a new configuration is imported, **When** user clicks reload service, **Then** skhd service reloads with the imported configuration

---

### Edge Cases

- What happens when skhd service is not running when reload is attempted?
- How does system handle reload when configuration file has syntax errors?
- What happens when log file becomes very large (>10MB)?
- How does system behave if skhd service fails to start after reload?
- What happens when user attempts to reload while a reload is already in progress?
- How are logs displayed if skhd has never been started?

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: System MUST display skhd service logs in chronological order (newest first or oldest first based on user preference)
- **FR-002**: System MUST automatically update log display when new log entries are generated by skhd service
- **FR-003**: System MUST visually distinguish between log levels (error, warning, info, debug)
- **FR-004**: System MUST provide a reload button that restarts the skhd service
- **FR-005**: System MUST reload skhd service with the currently active configuration file when reload is triggered
- **FR-006**: System MUST display success or failure feedback after reload attempt
- **FR-007**: System MUST allow users to import a configuration file before reloading
- **FR-008**: System MUST display the currently active configuration path
- **FR-009**: System MUST handle reload failures gracefully and provide actionable error messages
- **FR-010**: System MUST detect if skhd service is running or stopped
- **FR-011**: System MUST prevent concurrent reload operations
- **FR-012**: System MUST display skhd service log history as maintained by the skhd service itself (application displays whatever logs skhd has generated and retained)

### Key Entities

- **Log Entry**: Represents a single log line from skhd service with timestamp, log level, and message content
- **Service Status**: Represents current state of skhd service (running, stopped, reloading, error)
- **Active Configuration**: Reference to the configuration file currently in use by skhd service

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: Users can view skhd service logs within 2 seconds of opening the log viewer
- **SC-002**: New log entries appear in the viewer within 1 second of being generated by skhd service
- **SC-003**: Service reload completes within 5 seconds for typical configuration files
- **SC-004**: Users can successfully reload the service on first attempt in 95% of cases with valid configurations
- **SC-005**: Error messages provide sufficient information for users to resolve 80% of reload failures without external documentation
- **SC-006**: Users can import a different configuration and reload without using terminal commands

## Assumptions

- skhd service generates logs to a standard output stream or log file that can be accessed by the application
- Application has necessary system permissions to restart the skhd service
- skhd service supports graceful restart without disrupting the operating system
- Configuration files are stored in locations accessible to the application
- Standard log levels (error, warning, info, debug) are used or can be inferred from log format
- Log persistence and retention is managed by skhd service itself (application displays skhd's logs, does not manage log storage)

## Dependencies

- System permissions to read skhd logs and restart the service
- skhd service must support restart/reload operations
- Access to skhd service control mechanisms (launchctl on macOS or equivalent)

## Out of Scope

- Multiple configuration storage/management (uses existing import/export functionality)
- Log filtering and search capabilities (may be future enhancement)
- Log export functionality
- Custom log level configuration
- Multiple simultaneous skhd service instances
- Service installation or uninstallation
- Automatic service restart on configuration changes
- Log retention policies and cleanup
